<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Foodiefeed.BoardPage"
             Background="White"
             x:Name="Page"
             xmlns:local="clr-namespace:Foodiefeed;assembly=Foodiefeed"
             xmlns:viewmodel="clr-namespace:Foodiefeed.viewmodels"
             x:DataType="viewmodel:BoardViewModel"
             >

    
    <ContentPage.Resources>
        <local:AdjustPostSpace x:Key="AdjustPostSpace"/>
        <local:FollowOrNotFollowConverter x:Key="FollowOrNotFollowConverter"/>
        <x:Double x:Key="LeftBarHeightAdjustValue">100</x:Double>
        <x:Double x:Key="MidBarWidthAdjustValue">600</x:Double>
        <x:Double x:Key="MidBarHeightAdjustValue">100</x:Double>
        <x:Double x:Key="RightBarHeightAdjustValue">100</x:Double>
        <x:Double x:Key="BorderWidthValueAdjustment">-20</x:Double>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="100"/>
            <RowDefinition/>
        </Grid.RowDefinitions>

      

        <Grid ZIndex="10" Grid.Row="0">
                   <BoxView Color="White" 
                      WidthRequest="{Binding Source={x:Reference Page},Path=Width}" 
                      HeightRequest="100" 
                      VerticalOptions="Start">
                   <BoxView.Shadow>
                        <Shadow Opacity="0.8"/>
                   </BoxView.Shadow>
              </BoxView>

            <Border Margin="0,20,0,0" 
                    VerticalOptions="Start" 
                    Stroke="Gray" 
                    StrokeThickness="1.5" 
                    StrokeShape="RoundRectangle 20,20,20,20" 
                    HeightRequest="50" 
                    WidthRequest="420">

                <Entry TextColor="Black" 
                       FontSize="18" 
                       Placeholder="Search" 
                       Margin="0" 
                       HeightRequest="40" 
                       WidthRequest="400" 
                       Background="White"/>
            </Border>

            <ImageButton Source="logobutton.png" 
                HeightRequest="50" 
                WidthRequest="50" 
                VerticalOptions="Start" 
                HorizontalOptions="Start" 
                Margin="20"/>
        </Grid>

        <Grid Padding="0,0,0,0" Grid.Row="1">   <!--left for some pages buttons or custom flyout | middle for posts | left for friends-->
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition/>
            </Grid.ColumnDefinitions>
            
            <ScrollView HorizontalOptions="Start" 
                        VerticalOptions="Start" 
                        x:Name="testScroll" 
                        VerticalScrollBarVisibility="Always" 
                        WidthRequest="300"
                        HeightRequest="{Binding Source={x:Reference Page},Path=Height,Converter={StaticResource AdjustPostSpace},ConverterParameter={StaticResource LeftBarHeightAdjustValue}}" 
                        Grid.Column="0"> <!--pages-->
                <Grid HeightRequest="1000"  BackgroundColor="Red">
                    
                </Grid>
            </ScrollView>


            <Grid  WidthRequest="1000" Grid.Column="1">
                <CollectionView   
                              BackgroundColor="Green"
                              VerticalScrollBarVisibility="Always"
                              WidthRequest="{Binding Source={x:Reference Page},Path=Width,Converter={StaticResource AdjustPostSpace},ConverterParameter={StaticResource MidBarWidthAdjustValue}}"
                              HeightRequest="{Binding Source={x:Reference Page},Path=Height,Converter={StaticResource AdjustPostSpace},ConverterParameter={StaticResource MidBarHeightAdjustValue}}"                 
                              HorizontalOptions="Center"
                              ItemsSource="{Binding Posts}"
                              VerticalOptions="FillAndExpand"
                              >
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="local:Post" >

                        <Border WidthRequest="{Binding Source={x:Reference Post},Path=Width,Converter={StaticResource AdjustPostSpace},ConverterParameter={StaticResource BorderWidthValueAdjustment}}"
                                Margin="30" 
                                BackgroundColor="White" 
                                StrokeThickness="10" 
                                StrokeShape="RoundRectangle 20,20,20,20">
                            <Grid Background="Aqua" x:Name="Post" WidthRequest="800" BackgroundColor="White">
                                <Grid.RowDefinitions>
                                    <RowDefinition/> <!--0 username follow | 3 dots to go to profile-->
                                    <RowDefinition/> <!--1 post text content-->
                                    <RowDefinition/>  <!--2 images-->
                                    <RowDefinition/><!--3 like comments share-->
                                    <RowDefinition/> <!--4 comment section-->
                                </Grid.RowDefinitions>
                                <Grid  Padding="20" Grid.Row="0">
                                    <HorizontalStackLayout Spacing="10">
                                        <VerticalStackLayout>
                                            <Label TextColor="Black" FontSize="15" FontAttributes="Bold" Text="{Binding PosterUsername}"/>
                                            <Label TextColor="Black" FontSize="10" Text="10 hours ago"/>
                                        </VerticalStackLayout>
                                        <Label TextColor="Black" FontSize="15" FontAttributes="Bold" Text="•"/>
                                        <Label TextColor="Black" FontSize="15" FontAttributes="Bold" Text="{Binding isFollowed, Converter={StaticResource FollowOrNotFollowConverter}}"/>
                                    </HorizontalStackLayout>
                                    <ImageButton HorizontalOptions="End" HeightRequest="10"  Source="threedotfivexfive.png" />
                                </Grid>
                                <Grid Padding="20" Grid.Row="1" >
                                    <Label TextColor="Black" Text="{Binding PostTextContent}" LineBreakMode="WordWrap"/>
                                </Grid>

                                <Grid Padding="30,0,30,15" Grid.Row="2">

                                    <BoxView HeightRequest="300" WidthRequest="750" BackgroundColor="Orange"/>
                                    <ImageButton HorizontalOptions="Start" Margin="0,0,0,0" HeightRequest="40" Source="doubleleft.png"/>
                                    <ImageButton HorizontalOptions="End" HeightRequest="40" Source="doubleright.png"/>

                                </Grid>

                                <Grid Padding="0,0,0,10" Grid.Row="3">

                                    <HorizontalStackLayout  Spacing="-170">
                                        <Button BackgroundColor="Transparent" FontSize="20" WidthRequest="200" HeightRequest="50" Padding="20,0,0,0" Text="Like It!"/>
                                        <Image HeightRequest="40" Source="likeicon.png"/>
                                    </HorizontalStackLayout>

                                    <Button BackgroundColor="Transparent" FontSize="20" WidthRequest="200" HeightRequest="50" Padding="40,0,0,0" Text="Comment"/>
                                    <Image Margin="0,0,140,0" HeightRequest="40" Source="commenticon.png" />


                                    <Button  HorizontalOptions="End" BackgroundColor="Transparent" FontSize="20" WidthRequest="200" HeightRequest="50" Padding="0,0,0,0" Text="Share"/>
                                    <Image  Margin="0,0,140,0" HorizontalOptions="End"  HeightRequest="40" Source="shareicon.png"/>
                                </Grid>



                                <CollectionView HeightRequest="100" Grid.Row="4" VerticalScrollBarVisibility="Always"  ItemsSource="{Binding CommentSection}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="local:Comment">
                                            <Grid Padding="25" BackgroundColor="#e0e0e0">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition/>
                                                    <RowDefinition/>
                                                    <RowDefinition/>

                                                </Grid.RowDefinitions>
                                                <Grid  Grid.Row="0">
                                                    <Label TextColor="Black" Text="{Binding CommentPosterUsername}"/>
                                                    <ImageButton HorizontalOptions="End" HeightRequest="5"  Source="threedotfivexfive.png" />
                                                </Grid>
                                                <Grid  Grid.Row="1">
                                                    <Label TextColor="Black" Text="{Binding CommentTextContent}" LineBreakMode="WordWrap"/>
                                                </Grid>

                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>






                                <Grid Grid.Row="4"><!--comment section grid-->

                                </Grid>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            </Grid>







            <ScrollView HorizontalOptions="End" 
                        VerticalOptions="Start" 
                        VerticalScrollBarVisibility="Always" 
                        WidthRequest="300"
                        HeightRequest="{Binding Source={x:Reference Page},Path=Height,Converter={StaticResource AdjustPostSpace},ConverterParameter={StaticResource LeftBarHeightAdjustValue}}" 
                        Grid.Column="2">
                <!--friends-->
                <Grid HeightRequest="1000"  BackgroundColor="Blue">
                </Grid>
            </ScrollView>


        </Grid>




    </Grid>

</ContentPage>
